define(["core/config","components/map/mapModel","core/toolkitController","core/coreController","core/hashController"],function(e,a,t,n,r){var o={};return o._map,o._basemaps,o._legend,o.startup=function(){var e=t.loadPartial("components/map/mapPartial.html");return e.then(function(e){o.createUI(e)}),e},o.createUI=function(e){console.log("create Map UI");var n=1==t.getNodeList(".app-container").length,r=".app-container";n||(r="body"),t.injectHtml(r,e,"last"),a.startup(),a.bind(t.getNodeList(".map-container")[0]),o.createMap()},o.createMap=function(){var a=t.getMapClass(),n=e.appStateCurrent,r=new a("map",{basemap:n.b,center:[n.x,n.y],zoom:n.l});return o._map=r,r.on("load",function(){o.addLayers(r)}),r},o.addLayers=function(a){console.log("add layers");var n=[],n=t.arrayMap(e.services.layers,function(a){var n,r=a.url,o=r&&r.indexOf("http://")+r.indexOf("https://")<=-2,s=e.services.mapServerPrefix;o&&(r=s+r);var c=t.getLayerConstructor(a.type);switch(a.type){case"dynamic":n=new c(r,a);break;case"graphic":n=new c;break;case"feature":n=new c(r,a)}return n}),s=a.on("layers-add-result",function(){s.remove(),console.log("layers added"),o.addBasemap(a),a.on("extent-change",function(){var e=a.extent.getCenter(),n=t.convertWM(e,"wm"),o=a.getLevel();r.updateHashWithoutChangeDetect({x:n.x,y:n.y,l:o})})});a.addLayers(n)},o.addBasemap=function(e){console.log("Add basemap");var a=t.getBasemapDijit(),n=new a({showArcGISBasemaps:!0,map:e},t.getNodeList(".basemap-gallery")[0]);n.startup(),o.addLegend(e)},o.addLegend=function(e){console.log("Add Legend");var a=t.getLegendDijit(),n=new a({map:e},t.getNodeList(".legend")[0]);n.startup()},o.getMap=function(){return o._map},o.getBasemap=function(){return o._basemap},o.getLegend=function(){return o._getLegend},o.setBasemap=function(){var e="basemap_2";o._basemaps.select(e)},o.centerAndZoom=function(e,a){o._map.centerAndZoom(e,a)},o});